image: docker

services:
  - docker:dind


build:
  before_script:
    - docker info
    - docker 
    - curl -sS https://dl.yarnpkg.com/debian/pubkey.gpg | sudo apt-key add - && echo "deb https://dl.yarnpkg.com/debian/ stable main" | sudo tee /etc/apt/sources.list.d/yarn.list
    - sudo apt-get update && sudo apt-get install yarn
  script:
    - apk add --no-cache py-pip
    - pip install docker-compose
    - docker-compose up -d
    - sleep 7 # Wait for containers to start, temporary hack, to be removed after finding a better way
    - ./create_test_database
    - ./pytest_exec --cov http_quest --cov test test/
    - ./behave_exec 

